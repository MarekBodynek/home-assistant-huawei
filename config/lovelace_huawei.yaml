# Dashboard Huawei Solar - 3 kolumny PE≈ÅNA SZEROKO≈öƒÜ
# Sections view - nowy layout HA kt√≥ry u≈ºywa 100% szeroko≈õci ekranu
# COMMIT CHECK: b9e1bd2 - Test git pull

title: Huawei Solar PV
views:
  - title: PrzeglƒÖd
    icon: mdi:solar-power
    type: sections
    max_columns: 3
    sections:
      # SEKCJA 1 (lewa kolumna)
      - type: grid
        column_span: 1
        cards:
          # Pogoda
          - type: weather-forecast
            entity: weather.forecast_dom
            show_forecast: true
            forecast_type: hourly
            show_current: true

          # Bateria - wszystko w jednej karcie
          - type: entities
            title: ZarzƒÖdzanie BateriƒÖ
            icon: mdi:battery-charging
            entities:
              # Decyzje algorytmu
              - entity: input_text.battery_decision_reason
                name: üéØ Decyzja
                icon: mdi:chart-line
              - entity: input_number.battery_target_soc
                name: üéØ Target SOC (obliczony o 04:00)
              # Status baterii
              - entity: sensor.akumulatory_stan_pojemnosci
                name: üîã Stan na≈Çadowania (SOC)
                icon: mdi:battery-80
              - entity: switch.akumulatory_ladowanie_z_sieci
                name: ≈Åadowanie z sieci
              - entity: sensor.akumulatory_status
                name: Status baterii
              - entity: sensor.akumulatory_moc_ladowania_rozladowania
                name: Moc ≈Çadowania/roz≈Çadowania
                icon: mdi:battery-charging
              - entity: sensor.bateria_max_moc_rozladowania
                name: ‚ö° Max moc roz≈Çadowania
                icon: mdi:battery-minus
              # Temperatura baterii
              - entity: sensor.bateria_temperatura_maksymalna
                name: üå°Ô∏è Temperatura baterii (max)
                icon: mdi:thermometer-high
              - entity: binary_sensor.bateria_bezpieczna_temperatura
                name: ‚úÖ Bezpieczna temperatura
                icon: mdi:thermometer-check
              # Sterowanie
              - entity: select.akumulatory_tryb_pracy
                name: ‚öôÔ∏è Tryb pracy
            state_color: true

      # SEKCJA 2 (≈õrodkowa kolumna)
      - type: grid
        column_span: 1
        cards:
          # Ceny energii
          - type: entities
            title: Ceny energii
            icon: mdi:cash-multiple
            entities:
              - entity: sensor.strefa_taryfowa
                name: Strefa taryfowa G12w
                icon: mdi:clock-time-four-outline
              - entity: sensor.cena_zakupu_energii
                name: Cena zakupu (z sieci)
                icon: mdi:cash-minus
              - entity: sensor.cena_sprzedazy_energii
                name: Cena sprzeda≈ºy (do sieci)
                icon: mdi:cash-plus
              - entity: sensor.rce_srednia_wieczorna
                name: RCE ≈õrednia wieczorna (19-22h)
                icon: mdi:chart-timeline
              - entity: input_text.battery_cheapest_hours
                name: RCE najta≈Ñsze godziny
                icon: mdi:currency-usd

          # Prognoza PV i bilans mocy
          - type: entities
            title: Prognoza PV i bilans mocy
            icon: mdi:solar-power-variant
            entities:
              - entity: sensor.prognoza_pv_dzisiaj
                name: Prognoza PV dzi≈õ (pozosta≈Ço)
                icon: mdi:solar-power
              - entity: sensor.prognoza_pv_jutro
                name: Prognoza PV jutro
                icon: mdi:solar-power
              - entity: sensor.prognoza_pv_6h
                name: Prognoza PV nastƒôpne 6h
                icon: mdi:solar-power-variant
              - entity: sensor.nadwyzka_pv
                name: Nadwy≈ºka PV
                icon: mdi:solar-power
              - entity: sensor.deficyt_mocy
                name: Deficyt mocy
                icon: mdi:flash-alert
              - entity: input_text.battery_storage_status
                name: üìä Analiza
                icon: mdi:clock-outline

      # SEKCJA 3 (prawa kolumna)
      - type: grid
        column_span: 1
        cards:
          # Historia mocy (24h)
          - type: history-graph
            title: Historia mocy (24h)
            hours_to_show: 24
            entities:
              - entity: sensor.inwerter_moc_czynna
                name: Moc wyj≈õciowa
              - entity: sensor.akumulatory_moc_ladowania_rozladowania
                name: Bateria
              - entity: sensor.pomiar_mocy_moc_czynna
                name: Sieƒá

          # Produkcja energii
          - type: entities
            title: Produkcja energii
            icon: mdi:chart-line
            entities:
              - entity: sensor.inwerter_dzienna_produkcja
                name: Dzienna produkcja
                icon: mdi:weather-sunny
              - entity: sensor.inwerter_godzinowy_uzysk
                name: Uzysk w ostatniej godzinie
                icon: mdi:clock-outline

          # Sezon grzewczy
          - type: entities
            title: Sezon grzewczy
            icon: mdi:radiator
            entities:
              - entity: binary_sensor.sezon_grzewczy
                name: Sezon grzewczy aktywny
                icon: mdi:radiator
              - entity: binary_sensor.pc_co_aktywne
                name: Pompa ciep≈Ça CO aktywna
                icon: mdi:heat-pump
              - entity: binary_sensor.okno_cwu
                name: Okno CWU aktywne
                icon: mdi:water-boiler

          # Powiadomienia
          - type: entities
            title: Powiadomienia
            icon: mdi:bell
            entities:
              - entity: input_boolean.telegram_notifications_enabled
                name: üì± Telegram
                icon: mdi:telegram
              - entity: input_boolean.persistent_notifications_enabled
                name: üîî Powiadomienia UI
                icon: mdi:bell-ring
              - entity: input_select.telegram_notification_level
                name: üìä Min. poziom Telegram
                icon: mdi:filter

          # Event Log - Historia zdarze≈Ñ
          - type: markdown
            title: üìã Event Log
            content: |
              {% set s1 = state_attr('sensor.event_log_markdown', 'slot_1') %}
              {% set s2 = state_attr('sensor.event_log_markdown', 'slot_2') %}
              {% set s3 = state_attr('sensor.event_log_markdown', 'slot_3') %}
              {% if s1 and s1 not in ['', 'unknown'] %}
              {% set e = s1 | from_json %}
              {% if e.msg %}‚ÑπÔ∏è **{{ e.ts[:16] | replace('T', ' ') }}** [{{ e.cat }}] {{ e.msg }}{% endif %}
              {% endif %}
              {% if s2 and s2 not in ['', 'unknown'] %}
              {% set e = s2 | from_json %}
              {% if e.msg %}‚ÑπÔ∏è **{{ e.ts[:16] | replace('T', ' ') }}** [{{ e.cat }}] {{ e.msg }}{% endif %}
              {% endif %}
              {% if s3 and s3 not in ['', 'unknown'] %}
              {% set e = s3 | from_json %}
              {% if e.msg %}‚ÑπÔ∏è **{{ e.ts[:16] | replace('T', ' ') }}** [{{ e.cat }}] {{ e.msg }}{% endif %}
              {% endif %}

          # Event Log - Statystyki
          - type: entities
            title: üìä Event Log - Status
            icon: mdi:history
            entities:
              - entity: sensor.event_log_ostatnie_zdarzenie
                name: Ostatnie zdarzenie
              - entity: sensor.event_log_historia
                name: Historia (5 ostatnich)

  - title: Statystyki
    icon: mdi:chart-bar
    cards:
      - type: statistics-graph
        title: Bateria - ostatni tydzie≈Ñ
        stat_types:
          - mean
          - min
          - max
        entities:
          - sensor.akumulatory_stan_pojemnosci
        days_to_show: 7

      - type: statistics-graph
        title: Produkcja dzienna
        stat_types:
          - sum
        entities:
          - sensor.inwerter_dzienna_produkcja
        days_to_show: 30
        chart_type: bar
