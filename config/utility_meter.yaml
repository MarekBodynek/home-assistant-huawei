# ============================================
# UTILITY METER - Pomiary zuzycia energii
# ============================================
# Mierniki do zbierania danych o zuzyciu nocnym
# Reset o 22:00 - poczatek L2 (tania taryfa)

# Zuzycie nocne (22:00-06:00) - resetuje sie codziennie o 22:00
night_consumption:
  name: "Zuzycie nocne (od 22:00)"
  source: sensor.pomiar_mocy_zuzycie
  cycle: daily
  offset:
    hours: 22  # Reset o 22:00

# Zuzycie dzienne - standardowy reset o polnocy
daily_consumption:
  name: "Zuzycie dzienne"
  source: sensor.pomiar_mocy_zuzycie
  cycle: daily

# Zuzycie tygodniowe
weekly_consumption:
  name: "Zuzycie tygodniowe"
  source: sensor.pomiar_mocy_zuzycie
  cycle: weekly

# Zuzycie miesieczne
monthly_consumption:
  name: "Zuzycie miesieczne"
  source: sensor.pomiar_mocy_zuzycie
  cycle: monthly

# ============================================
# DANE GODZINOWE DLA MACHINE LEARNING
# ============================================
# Resetują się co godzinę - użyj automatyzacji do zapisywania przed resetem

# Zużycie godzinowe
hourly_consumption:
  name: "Zuzycie godzinowe"
  source: sensor.pomiar_mocy_zuzycie
  cycle: hourly

# Produkcja PV godzinowa (DC input z paneli)
hourly_pv_production:
  name: "Produkcja PV godzinowa (DC)"
  source: sensor.inwerter_total_dc_input_energy
  cycle: hourly

# Eksport do sieci godzinowy
hourly_grid_export:
  name: "Eksport godzinowy"
  source: sensor.pomiar_mocy_eksport
  cycle: hourly

# Eksport do sieci dzienny (potrzebny do kalkulacji Real PV)
daily_grid_export:
  name: "Eksport dzienny"
  source: sensor.pomiar_mocy_eksport
  cycle: daily

# Ładowanie baterii godzinowe
hourly_battery_charge:
  name: "Ladowanie baterii godzinowe"
  source: sensor.akumulatory_ladowania_dzienne
  cycle: hourly

# Rozładowanie baterii godzinowe
hourly_battery_discharge:
  name: "Rozladowanie baterii godzinowe"
  source: sensor.akumulatory_rozladowanie_dzienne
  cycle: hourly

# ============================================
# PRODUKCJA PV - PRAWDZIWA (DC input z paneli)
# ============================================
# POPRAWNY SENSOR: sensor.inwerter_total_dc_input_energy
#   = energia DC wchodząca z paneli PV (skumulowana od instalacji)
#   = PRAWDZIWA produkcja PV!
#
# BŁĘDNY SENSOR: sensor.inwerter_calkowita_produkcja_energii
#   = AC output inwertera (zawiera rozładowanie baterii!)
#   = NIE jest to produkcja PV!
#
# Weryfikacja (26.11.2025):
#   DC input o północy: 38152.41 kWh → teraz: 38154.97 kWh
#   Różnica = 2.56 kWh (potwierdzone wykresem FusionSolar)

# Dzienna produkcja PV (reset o północy) - prawdziwa produkcja DC
daily_pv_production:
  name: "Dzienna produkcja PV (DC)"
  source: sensor.inwerter_total_dc_input_energy
  cycle: daily
